openapi: 3.0.1
info:
  title: dotnet-monitor
  version: v1
paths:
  /processes:
    get:
      tags:
        - Diag
      operationId: GetProcesses
      responses:
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationProblemDetails'
        '401':
          description: Unauthorized
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ProcessIdentifier'
  /process:
    get:
      tags:
        - Diag
      operationId: GetProcessInfo
      parameters:
        - name: pid
          in: query
          schema:
            type: integer
            format: int32
        - name: uid
          in: query
          schema:
            type: string
            format: uuid
        - name: name
          in: query
          schema:
            type: string
      responses:
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationProblemDetails'
        '401':
          description: Unauthorized
        '200':
          description: Success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProcessInfo'
  /env:
    get:
      tags:
        - Diag
      operationId: GetProcessEnvironment
      parameters:
        - name: pid
          in: query
          schema:
            type: integer
            format: int32
        - name: uid
          in: query
          schema:
            type: string
            format: uuid
        - name: name
          in: query
          schema:
            type: string
      responses:
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationProblemDetails'
        '401':
          description: Unauthorized
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: object
                additionalProperties:
                  type: string
  /dump:
    get:
      tags:
        - Diag
      operationId: CaptureDump
      parameters:
        - name: pid
          in: query
          schema:
            type: integer
            format: int32
        - name: uid
          in: query
          schema:
            type: string
            format: uuid
        - name: name
          in: query
          schema:
            type: string
        - name: type
          in: query
          schema:
            $ref: '#/components/schemas/DumpType'
        - name: egressProvider
          in: query
          schema:
            type: string
        - name: tags
          in: query
          schema:
            type: string
      responses:
        '400':
          description: Bad Request
          content:
            application/octet-stream:
              schema:
                $ref: '#/components/schemas/ValidationProblemDetails'
        '401':
          description: Unauthorized
        '429':
          description: Too Many Requests
          content:
            application/octet-stream:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
        '200':
          description: Success
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary
        '202':
          description: Accepted
  /gcdump:
    get:
      tags:
        - Diag
      operationId: CaptureGcDump
      parameters:
        - name: pid
          in: query
          schema:
            type: integer
            format: int32
        - name: uid
          in: query
          schema:
            type: string
            format: uuid
        - name: name
          in: query
          schema:
            type: string
        - name: egressProvider
          in: query
          schema:
            type: string
        - name: tags
          in: query
          schema:
            type: string
      responses:
        '400':
          description: Bad Request
          content:
            application/octet-stream:
              schema:
                $ref: '#/components/schemas/ValidationProblemDetails'
        '401':
          description: Unauthorized
        '429':
          description: Too Many Requests
          content:
            application/octet-stream:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
        '200':
          description: Success
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary
        '202':
          description: Accepted
  /trace:
    get:
      tags:
        - Diag
      operationId: CaptureTrace
      parameters:
        - name: pid
          in: query
          schema:
            type: integer
            format: int32
        - name: uid
          in: query
          schema:
            type: string
            format: uuid
        - name: name
          in: query
          schema:
            type: string
        - name: profile
          in: query
          schema:
            $ref: '#/components/schemas/TraceProfile'
        - name: durationSeconds
          in: query
          schema:
            maximum: 2147483647
            minimum: -1
            type: integer
            format: int32
            default: 30
        - name: egressProvider
          in: query
          schema:
            type: string
        - name: tags
          in: query
          schema:
            type: string
      responses:
        '400':
          description: Bad Request
          content:
            application/octet-stream:
              schema:
                $ref: '#/components/schemas/ValidationProblemDetails'
        '401':
          description: Unauthorized
        '429':
          description: Too Many Requests
          content:
            application/octet-stream:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
        '200':
          description: Success
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary
        '202':
          description: Accepted
    post:
      tags:
        - Diag
      operationId: CaptureTraceCustom
      parameters:
        - name: pid
          in: query
          schema:
            type: integer
            format: int32
        - name: uid
          in: query
          schema:
            type: string
            format: uuid
        - name: name
          in: query
          schema:
            type: string
        - name: durationSeconds
          in: query
          schema:
            maximum: 2147483647
            minimum: -1
            type: integer
            format: int32
            default: 30
        - name: egressProvider
          in: query
          schema:
            type: string
        - name: tags
          in: query
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EventPipeConfiguration'
          text/json:
            schema:
              $ref: '#/components/schemas/EventPipeConfiguration'
          application/*+json:
            schema:
              $ref: '#/components/schemas/EventPipeConfiguration'
        required: true
      responses:
        '400':
          description: Bad Request
          content:
            application/octet-stream:
              schema:
                $ref: '#/components/schemas/ValidationProblemDetails'
        '401':
          description: Unauthorized
        '429':
          description: Too Many Requests
          content:
            application/octet-stream:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
        '200':
          description: Success
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary
        '202':
          description: Accepted
  /logs:
    get:
      tags:
        - Diag
      operationId: CaptureLogs
      parameters:
        - name: pid
          in: query
          schema:
            type: integer
            format: int32
        - name: uid
          in: query
          schema:
            type: string
            format: uuid
        - name: name
          in: query
          schema:
            type: string
        - name: durationSeconds
          in: query
          schema:
            maximum: 2147483647
            minimum: -1
            type: integer
            format: int32
            default: 30
        - name: level
          in: query
          schema:
            $ref: '#/components/schemas/LogLevel'
        - name: egressProvider
          in: query
          schema:
            type: string
        - name: tags
          in: query
          schema:
            type: string
      responses:
        '400':
          description: Bad Request
          content:
            application/x-ndjson:
              schema:
                $ref: '#/components/schemas/ValidationProblemDetails'
            application/json-seq:
              schema:
                $ref: '#/components/schemas/ValidationProblemDetails'
            text/plain:
              schema:
                $ref: '#/components/schemas/ValidationProblemDetails'
        '401':
          description: Unauthorized
        '429':
          description: Too Many Requests
          content:
            application/x-ndjson:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
            application/json-seq:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
            text/plain:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
        '200':
          description: Success
          content:
            application/x-ndjson:
              schema:
                type: string
            application/json-seq:
              schema:
                type: string
            text/plain:
              schema:
                type: string
        '202':
          description: Accepted
    post:
      tags:
        - Diag
      operationId: CaptureLogsCustom
      parameters:
        - name: pid
          in: query
          schema:
            type: integer
            format: int32
        - name: uid
          in: query
          schema:
            type: string
            format: uuid
        - name: name
          in: query
          schema:
            type: string
        - name: durationSeconds
          in: query
          schema:
            maximum: 2147483647
            minimum: -1
            type: integer
            format: int32
            default: 30
        - name: egressProvider
          in: query
          schema:
            type: string
        - name: tags
          in: query
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LogsConfiguration'
          text/json:
            schema:
              $ref: '#/components/schemas/LogsConfiguration'
          application/*+json:
            schema:
              $ref: '#/components/schemas/LogsConfiguration'
      responses:
        '400':
          description: Bad Request
          content:
            application/x-ndjson:
              schema:
                $ref: '#/components/schemas/ValidationProblemDetails'
            application/json-seq:
              schema:
                $ref: '#/components/schemas/ValidationProblemDetails'
            text/plain:
              schema:
                $ref: '#/components/schemas/ValidationProblemDetails'
        '401':
          description: Unauthorized
        '429':
          description: Too Many Requests
          content:
            application/x-ndjson:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
            application/json-seq:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
            text/plain:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
        '200':
          description: Success
          content:
            application/x-ndjson:
              schema:
                type: string
            application/json-seq:
              schema:
                type: string
            text/plain:
              schema:
                type: string
        '202':
          description: Accepted
  /info:
    get:
      tags:
        - Diag
      operationId: GetInfo
      responses:
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationProblemDetails'
        '401':
          description: Unauthorized
        '200':
          description: Success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DotnetMonitorInfo'
  /collectionrules:
    get:
      tags:
        - Diag
      operationId: GetCollectionRulesDescription
      parameters:
        - name: pid
          in: query
          schema:
            type: integer
            format: int32
        - name: uid
          in: query
          schema:
            type: string
            format: uuid
        - name: name
          in: query
          schema:
            type: string
      responses:
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationProblemDetails'
        '401':
          description: Unauthorized
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: object
                additionalProperties:
                  $ref: '#/components/schemas/CollectionRuleDescription'
  '/collectionrules/{collectionRuleName}':
    get:
      tags:
        - Diag
      operationId: GetCollectionRuleDetailedDescription
      parameters:
        - name: collectionRuleName
          in: path
          required: true
          schema:
            type: string
        - name: pid
          in: query
          schema:
            type: integer
            format: int32
        - name: uid
          in: query
          schema:
            type: string
            format: uuid
        - name: name
          in: query
          schema:
            type: string
      responses:
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationProblemDetails'
        '401':
          description: Unauthorized
        '200':
          description: Success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CollectionRuleDetailedDescription'
  /stacks:
    get:
      tags:
        - Diag
      operationId: CaptureStacks
      parameters:
        - name: pid
          in: query
          schema:
            type: integer
            format: int32
        - name: uid
          in: query
          schema:
            type: string
            format: uuid
        - name: name
          in: query
          schema:
            type: string
        - name: egressProvider
          in: query
          schema:
            type: string
        - name: tags
          in: query
          schema:
            type: string
      responses:
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationProblemDetails'
            text/plain:
              schema:
                $ref: '#/components/schemas/ValidationProblemDetails'
            application/speedscope+json:
              schema:
                $ref: '#/components/schemas/ValidationProblemDetails'
        '401':
          description: Unauthorized
        '429':
          description: Too Many Requests
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
            text/plain:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
            application/speedscope+json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: string
            text/plain:
              schema:
                type: string
            application/speedscope+json:
              schema:
                type: string
        '202':
          description: Accepted
  /livemetrics:
    get:
      tags:
        - Diag
      operationId: CaptureMetrics
      parameters:
        - name: pid
          in: query
          schema:
            type: integer
            format: int32
        - name: uid
          in: query
          schema:
            type: string
            format: uuid
        - name: name
          in: query
          schema:
            type: string
        - name: durationSeconds
          in: query
          schema:
            maximum: 2147483647
            minimum: -1
            type: integer
            format: int32
            default: 30
        - name: egressProvider
          in: query
          schema:
            type: string
        - name: tags
          in: query
          schema:
            type: string
      responses:
        '400':
          description: Bad Request
          content:
            application/json-seq:
              schema:
                $ref: '#/components/schemas/ValidationProblemDetails'
        '401':
          description: Unauthorized
        '429':
          description: Too Many Requests
          content:
            application/json-seq:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
        '202':
          description: Accepted
    post:
      tags:
        - Diag
      operationId: CaptureMetricsCustom
      parameters:
        - name: pid
          in: query
          schema:
            type: integer
            format: int32
        - name: uid
          in: query
          schema:
            type: string
            format: uuid
        - name: name
          in: query
          schema:
            type: string
        - name: durationSeconds
          in: query
          schema:
            maximum: 2147483647
            minimum: -1
            type: integer
            format: int32
            default: 30
        - name: egressProvider
          in: query
          schema:
            type: string
        - name: tags
          in: query
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EventMetricsConfiguration'
          text/json:
            schema:
              $ref: '#/components/schemas/EventMetricsConfiguration'
          application/*+json:
            schema:
              $ref: '#/components/schemas/EventMetricsConfiguration'
        required: true
      responses:
        '400':
          description: Bad Request
          content:
            application/json-seq:
              schema:
                $ref: '#/components/schemas/ValidationProblemDetails'
        '401':
          description: Unauthorized
        '429':
          description: Too Many Requests
          content:
            application/json-seq:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
        '202':
          description: Accepted
  /metrics:
    get:
      tags:
        - Metrics
      operationId: GetMetrics
      responses:
        '400':
          description: Bad Request
          content:
            text/plain; version=0.0.4:
              schema:
                $ref: '#/components/schemas/ValidationProblemDetails'
        '200':
          description: Success
          content:
            text/plain; version=0.0.4:
              schema:
                type: string
  /operations:
    get:
      tags:
        - Operations
      parameters:
        - name: pid
          in: query
          schema:
            type: integer
            format: int32
        - name: uid
          in: query
          schema:
            type: string
            format: uuid
        - name: name
          in: query
          schema:
            type: string
        - name: tags
          in: query
          schema:
            type: string
      responses:
        '401':
          description: Unauthorized
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/OperationSummary'
  '/operations/{operationId}':
    get:
      tags:
        - Operations
      parameters:
        - name: operationId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '401':
          description: Unauthorized
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OperationStatus'
        '200':
          description: Success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OperationStatus'
    delete:
      tags:
        - Operations
      parameters:
        - name: operationId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: stop
          in: query
          schema:
            type: boolean
            default: false
      responses:
        '401':
          description: Unauthorized
        '200':
          description: Success
        '202':
          description: Accepted
components:
  schemas:
    CollectionRuleDescription:
      type: object
      properties:
        state:
          $ref: '#/components/schemas/CollectionRuleState'
        stateReason:
          type: string
          nullable: true
      additionalProperties: false
    CollectionRuleDetailedDescription:
      type: object
      properties:
        state:
          $ref: '#/components/schemas/CollectionRuleState'
        stateReason:
          type: string
          nullable: true
        lifetimeOccurrences:
          type: integer
          format: int32
        slidingWindowOccurrences:
          type: integer
          format: int32
        actionCountLimit:
          type: integer
          format: int32
        actionCountSlidingWindowDurationLimit:
          $ref: '#/components/schemas/TimeSpan'
        slidingWindowDurationCountdown:
          $ref: '#/components/schemas/TimeSpan'
        ruleFinishedCountdown:
          $ref: '#/components/schemas/TimeSpan'
      additionalProperties: false
    CollectionRuleState:
      enum:
        - Running
        - ActionExecuting
        - Throttled
        - Finished
      type: string
    DiagnosticPortConnectionMode:
      enum:
        - Connect
        - Listen
      type: string
    DotnetMonitorInfo:
      type: object
      properties:
        version:
          type: string
          nullable: true
        runtimeVersion:
          type: string
          nullable: true
        diagnosticPortMode:
          $ref: '#/components/schemas/DiagnosticPortConnectionMode'
        diagnosticPortName:
          type: string
          nullable: true
      additionalProperties: false
    DumpType:
      enum:
        - Full
        - Mini
        - WithHeap
        - Triage
      type: string
    EventLevel:
      enum:
        - LogAlways
        - Critical
        - Error
        - Warning
        - Informational
        - Verbose
      type: string
    EventMetricsConfiguration:
      type: object
      properties:
        includeDefaultProviders:
          type: boolean
        providers:
          type: array
          items:
            $ref: '#/components/schemas/EventMetricsProvider'
          nullable: true
      additionalProperties: false
    EventMetricsProvider:
      required:
        - providerName
      type: object
      properties:
        providerName:
          minLength: 1
          type: string
        counterNames:
          type: array
          items:
            type: string
          nullable: true
      additionalProperties: false
    EventPipeConfiguration:
      required:
        - providers
      type: object
      properties:
        providers:
          minItems: 1
          type: array
          items:
            $ref: '#/components/schemas/EventPipeProvider'
        requestRundown:
          type: boolean
        bufferSizeInMB:
          maximum: 1024
          minimum: 1
          type: integer
          format: int32
      additionalProperties: false
    EventPipeProvider:
      required:
        - name
      type: object
      properties:
        name:
          minLength: 1
          type: string
        keywords:
          type: string
          nullable: true
        eventLevel:
          $ref: '#/components/schemas/EventLevel'
        arguments:
          type: object
          additionalProperties:
            type: string
          nullable: true
      additionalProperties: false
    LogLevel:
      enum:
        - Trace
        - Debug
        - Information
        - Warning
        - Error
        - Critical
        - None
      type: string
    LogsConfiguration:
      required:
        - logLevel
      type: object
      properties:
        logLevel:
          $ref: '#/components/schemas/LogLevel'
        filterSpecs:
          type: object
          additionalProperties:
            $ref: '#/components/schemas/LogLevel'
          nullable: true
        useAppFilters:
          type: boolean
      additionalProperties: false
    OperationError:
      type: object
      properties:
        code:
          type: string
          nullable: true
        message:
          type: string
          nullable: true
      additionalProperties: false
    OperationProcessInfo:
      type: object
      properties:
        pid:
          type: integer
          format: int32
        uid:
          type: string
          format: uuid
        name:
          type: string
          nullable: true
      additionalProperties: false
    OperationState:
      enum:
        - Running
        - Succeeded
        - Failed
        - Cancelled
        - Stopping
      type: string
    OperationStatus:
      type: object
      properties:
        operationId:
          type: string
          format: uuid
        createdDateTime:
          type: string
          format: date-time
        status:
          $ref: '#/components/schemas/OperationState'
        process:
          $ref: '#/components/schemas/OperationProcessInfo'
        egressProviderName:
          type: string
          nullable: true
        isStoppable:
          type: boolean
        tags:
          uniqueItems: true
          type: array
          items:
            type: string
          nullable: true
        resourceLocation:
          type: string
          nullable: true
        error:
          $ref: '#/components/schemas/OperationError'
      additionalProperties: false
    OperationSummary:
      type: object
      properties:
        operationId:
          type: string
          format: uuid
        createdDateTime:
          type: string
          format: date-time
        status:
          $ref: '#/components/schemas/OperationState'
        process:
          $ref: '#/components/schemas/OperationProcessInfo'
        egressProviderName:
          type: string
          nullable: true
        isStoppable:
          type: boolean
        tags:
          uniqueItems: true
          type: array
          items:
            type: string
          nullable: true
      additionalProperties: false
    ProblemDetails:
      type: object
      properties:
        type:
          type: string
          nullable: true
        title:
          type: string
          nullable: true
        status:
          type: integer
          format: int32
          nullable: true
        detail:
          type: string
          nullable: true
        instance:
          type: string
          nullable: true
      additionalProperties: { }
    ProcessIdentifier:
      type: object
      properties:
        pid:
          type: integer
          format: int32
        uid:
          type: string
          format: uuid
        name:
          type: string
          nullable: true
        isDefault:
          type: boolean
      additionalProperties: false
    ProcessInfo:
      type: object
      properties:
        pid:
          type: integer
          format: int32
        uid:
          type: string
          format: uuid
        name:
          type: string
          nullable: true
        commandLine:
          type: string
          nullable: true
        operatingSystem:
          type: string
          nullable: true
        processArchitecture:
          type: string
          nullable: true
      additionalProperties: false
    TimeSpan:
      type: object
      properties:
        ticks:
          type: integer
          format: int64
        days:
          type: integer
          format: int32
          readOnly: true
        hours:
          type: integer
          format: int32
          readOnly: true
        milliseconds:
          type: integer
          format: int32
          readOnly: true
        minutes:
          type: integer
          format: int32
          readOnly: true
        seconds:
          type: integer
          format: int32
          readOnly: true
        totalDays:
          type: number
          format: double
          readOnly: true
        totalHours:
          type: number
          format: double
          readOnly: true
        totalMilliseconds:
          type: number
          format: double
          readOnly: true
        totalMinutes:
          type: number
          format: double
          readOnly: true
        totalSeconds:
          type: number
          format: double
          readOnly: true
      additionalProperties: false
    TraceProfile:
      enum:
        - Cpu
        - Http
        - Logs
        - Metrics
      type: string
    ValidationProblemDetails:
      type: object
      properties:
        type:
          type: string
          nullable: true
        title:
          type: string
          nullable: true
        status:
          type: integer
          format: int32
          nullable: true
        detail:
          type: string
          nullable: true
        instance:
          type: string
          nullable: true
        errors:
          type: object
          additionalProperties:
            type: array
            items:
              type: string
          nullable: true
          readOnly: true
      additionalProperties: { }